# React Native ä»£ç åˆ†å‰²é…ç½®æŒ‡å—

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜å¦‚ä½•åœ¨é¡¹ç›®ä¸­é…ç½®ä¸»åŒ…å’Œåˆ†åŒ…ï¼ˆCode Splittingï¼‰ã€‚

## ç›®å½•

- [åŸºç¡€æ¦‚å¿µ](#åŸºç¡€æ¦‚å¿µ)
- [ä¸»åŒ…é…ç½®](#ä¸»åŒ…é…ç½®)
- [åˆ†åŒ…é…ç½®](#åˆ†åŒ…é…ç½®)
- [æœ€ä½³å®è·µ](#æœ€ä½³å®è·µ)
- [å¸¸è§é—®é¢˜](#å¸¸è§é—®é¢˜)

---

## åŸºç¡€æ¦‚å¿µ

### ä»€ä¹ˆæ˜¯ä¸»åŒ…ï¼Ÿ

**ä¸»åŒ…ï¼ˆMain Bundleï¼‰** æ˜¯åº”ç”¨å¯åŠ¨æ—¶å¿…éœ€åŠ è½½çš„ä»£ç åŒ…ï¼ŒåŒ…å«ï¼š

- åº”ç”¨å…¥å£æ–‡ä»¶ï¼ˆ`App.tsx`ã€`index.js`ï¼‰
- æ ¸å¿ƒå¯¼èˆªç»“æ„
- å¯åŠ¨é¡µã€ç™»å½•é¡µã€åº•éƒ¨ Tab å¯¼èˆªé¡µ
- å¿…é¡»åŒæ­¥ä½¿ç”¨çš„æ ¸å¿ƒç»„ä»¶

### ä»€ä¹ˆæ˜¯åˆ†åŒ…ï¼Ÿ

**åˆ†åŒ…ï¼ˆChunk Bundleï¼‰** æ˜¯æŒ‰éœ€åŠ è½½çš„ç‹¬ç«‹ä»£ç åŒ…ï¼ŒåŒ…å«ï¼š

- åŠŸèƒ½é¡µé¢ï¼ˆå¦‚ä¸ªäººè®¾ç½®ã€é€šçŸ¥è¯¦æƒ…ï¼‰
- ä¸å¸¸ç”¨çš„é¡µé¢
- å¯ä»¥å»¶è¿ŸåŠ è½½çš„æ¨¡å—

### ä¸ºä»€ä¹ˆè¦åˆ†åŒ…ï¼Ÿ

| ä¼˜åŠ¿             | è¯´æ˜                   |
| ---------------- | ---------------------- |
| **å‡å°ä¸»åŒ…ä½“ç§¯** | é¦–æ¬¡å¯åŠ¨æ›´å¿«           |
| **æŒ‰éœ€åŠ è½½**     | åªåŠ è½½éœ€è¦çš„é¡µé¢       |
| **è¿œç¨‹æ›´æ–°**     | æ— éœ€å‘ç‰ˆå³å¯æ›´æ–°åŠŸèƒ½é¡µ |
| **æå‡æ€§èƒ½**     | å‡å°‘å†…å­˜å ç”¨           |

---

## ä¸»åŒ…é…ç½®

### 1. ç›´æ¥å¯¼å…¥ï¼ˆåŒæ­¥ï¼‰

ä½¿ç”¨ `import` è¯­å¥ç›´æ¥å¯¼å…¥çš„ç»„ä»¶ä¼šè¢«æ‰“åŒ…åˆ°ä¸»åŒ…ï¼š

```typescript
// âœ… ä¸»åŒ…é…ç½®
import ProfileScreen from '../screens/ProfileScreen';
import RecommendScreen from '../screens/RecommendScreen';
import ExploreScreen from '../screens/ExploreScreen';
import NotificationsScreen from '../screens/NotificationsScreen';

// åœ¨å¯¼èˆªä¸­ä½¿ç”¨
<Tab.Screen
  name="Profile"
  component={ProfileScreen} // ç›´æ¥å¼•ç”¨ï¼ŒåŒæ­¥åŠ è½½
  options={{ tabBarLabel: 'ä¸ªäºº' }}
/>;
```

### 2. ä»€ä¹ˆæ—¶å€™ç”¨ä¸»åŒ…ï¼Ÿ

**é€‚åˆä¸»åŒ…çš„é¡µé¢ï¼š**

- âœ… åº•éƒ¨ Tab å¯¼èˆªçš„æ ¸å¿ƒé¡µé¢
- âœ… å¯åŠ¨é¡µã€ç™»å½•é¡µã€æ³¨å†Œé¡µ
- âœ… é¦–é¡µã€å‘ç°é¡µç­‰é«˜é¢‘é¡µé¢
- âœ… åº•éƒ¨ Tab æ ç»„ä»¶æœ¬èº«
- âœ… å…¨å±€å…¬å…±ç»„ä»¶ï¼ˆToastã€Dialogã€Loadingï¼‰

**ç¤ºä¾‹ï¼šåº•éƒ¨å¯¼èˆªåº”è¯¥å…¨éƒ¨ä¸»åŒ…**

```typescript
// src/navigation/TabNavigator.tsx
import React from 'react';
import { createBottomTabNavigator } from '@react-navigation/bottom-tabs';

// âœ… æ‰€æœ‰ Tab é¡µé¢éƒ½æ˜¯ä¸»åŒ…
import HomeScreen from '../screens/HomeScreen';
import ExploreScreen from '../screens/ExploreScreen';
import OrdersScreen from '../screens/OrdersScreen';
import ProfileScreen from '../screens/ProfileScreen';

const Tab = createBottomTabNavigator();

export default function TabNavigator() {
  return (
    <Tab.Navigator>
      <Tab.Screen name="Home" component={HomeScreen} />
      <Tab.Screen name="Explore" component={ExploreScreen} />
      <Tab.Screen name="Orders" component={OrdersScreen} />
      <Tab.Screen name="Profile" component={ProfileScreen} />
    </Tab.Navigator>
  );
}
```

---

## åˆ†åŒ…é…ç½®

### 1. React.lazy åŠ¨æ€å¯¼å…¥

ä½¿ç”¨ `React.lazy()` + `import()` åŠ¨æ€å¯¼å…¥çš„ç»„ä»¶ä¼šæˆä¸ºç‹¬ç«‹åˆ†åŒ…ï¼š

```typescript
// âœ… åˆ†åŒ…é…ç½®
const SettingsScreen = React.lazy(
  () => import(/* webpackChunkName: "settings" */ '../screens/SettingsScreen'),
);

const OrderDetailScreen = React.lazy(
  () =>
    import(
      /* webpackChunkName: "order-detail" */ '../screens/OrderDetailScreen'
    ),
);
```

**å…³é”®ç‚¹ï¼š**

1. ä½¿ç”¨ `React.lazy()` åŒ…è£…
2. ä½¿ç”¨ `import()` åŠ¨æ€å¯¼å…¥
3. **å¿…é¡»æ·»åŠ ** `/* webpackChunkName: "xxx" */` æ³¨é‡Šå‘½ååˆ†åŒ…

### 2. å®Œæ•´çš„åˆ†åŒ…é…ç½®ç¤ºä¾‹

```typescript
// src/navigation/RootNavigator.tsx
import React, { Suspense } from 'react';
import { NavigationContainer } from '@react-navigation/native';
import { createNativeStackNavigator } from '@react-navigation/native-stack';
import { View, ActivityIndicator } from 'react-native';

// ä¸»åŒ…ï¼šç›´æ¥å¯¼å…¥
import TabNavigator from './TabNavigator';
import LoginScreen from '../screens/LoginScreen';

// åˆ†åŒ…ï¼šåŠ¨æ€å¯¼å…¥
const SettingsScreen = React.lazy(
  () => import(/* webpackChunkName: "settings" */ '../screens/SettingsScreen'),
);

const AboutScreen = React.lazy(
  () => import(/* webpackChunkName: "about" */ '../screens/AboutScreen'),
);

// åˆ†åŒ…åŠ è½½çŠ¶æ€
function ChunkLoader() {
  return (
    <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
      <ActivityIndicator size="large" color="#6366f1" />
    </View>
  );
}

const Stack = createNativeStackNavigator();

export default function RootNavigator() {
  return (
    <NavigationContainer>
      <Suspense fallback={<ChunkLoader />}>
        <Stack.Navigator screenOptions={{ headerShown: false }}>
          {/* ä¸»åŒ…é¡µé¢ */}
          <Stack.Screen name="Login" component={LoginScreen} />
          <Stack.Screen name="MainTabs" component={TabNavigator} />

          {/* åˆ†åŒ…é¡µé¢ - æŒ‰éœ€åŠ è½½ */}
          <Stack.Screen name="Settings" component={SettingsScreen} />
          <Stack.Screen name="About" component={AboutScreen} />
        </Stack.Navigator>
      </Suspense>
    </NavigationContainer>
  );
}
```

### 3. ä»€ä¹ˆæ—¶å€™ç”¨åˆ†åŒ…ï¼Ÿ

**é€‚åˆåˆ†åŒ…çš„é¡µé¢ï¼š**

- âœ… è®¾ç½®é¡µã€å…³äºé¡µç­‰ä½é¢‘é¡µé¢
- âœ… é€šçŸ¥è¯¦æƒ…ã€å•†å“è¯¦æƒ…ç­‰æ·±å±‚é¡µé¢
- âœ… ä¸ªäººèµ„æ–™ç¼–è¾‘ã€è¡¨å•é¡µé¢
- âœ… ä¸å½±å“é¦–æ¬¡å¯åŠ¨çš„åŠŸèƒ½é¡µ

**ç¤ºä¾‹ï¼šè®¾ç½®é¡µåº”è¯¥æ˜¯åˆ†åŒ…**

```typescript
// âŒ é”™è¯¯ï¼šè®¾ç½®é¡µä¸åº”è¯¥ä¸»åŒ…
import SettingsScreen from '../screens/SettingsScreen';

// âœ… æ­£ç¡®ï¼šè®¾ç½®é¡µåº”è¯¥åˆ†åŒ…
const SettingsScreen = React.lazy(
  () => import(/* webpackChunkName: "settings" */ '../screens/SettingsScreen'),
);
```

---

## æœ€ä½³å®è·µ

### 1. åˆ†åŒ…å‘½åè§„èŒƒ

```typescript
// âœ… å¥½çš„å‘½åï¼šæ¸…æ™°ã€æœ‰æ„ä¹‰
/* webpackChunkName: "user-profile" */
/* webpackChunkName: "order-detail" */
/* webpackChunkName: "settings" */

// âŒ é¿å…çš„å‘½åï¼šæ¨¡ç³Šã€æ— æ„ä¹‰
/* webpackChunkName: "chunk1" */
/* webpackChunkName: "screen" */
/* webpackChunkName: "temp" */
```

### 2. åˆ†åŒ…ç²’åº¦

```typescript
// âœ… æ¨èï¼šä¸€ä¸ªé¡µé¢ä¸€ä¸ªåˆ†åŒ…
const UserProfileScreen = React.lazy(
  () =>
    import(
      /* webpackChunkName: "user-profile" */ '../screens/UserProfileScreen'
    ),
);

// âŒ é¿å…ï¼šåˆ†åŒ…è¿‡å¤§ï¼ˆå¤šä¸ªé¡µé¢åˆå¹¶åˆ°ä¸€ä¸ªåˆ†åŒ…ï¼‰
const MultipleScreens = React.lazy(
  () => import(/* webpackChunkName: "huge-chunk" */ '../screens/ManyScreens'),
);

// âŒ é¿å…ï¼šåˆ†åŒ…è¿‡å°ï¼ˆç»„ä»¶çº§åˆ«åˆ†åŒ…ï¼‰
const SmallComponent = React.lazy(
  () =>
    import(
      /* webpackChunkName: "tiny-component" */ '../components/SmallComponent'
    ),
);
```

### 3. å…±äº«ä¾èµ–å¤„ç†

```typescript
// âœ… å…¬å…±ç»„ä»¶åº”è¯¥ä¸»åŒ…
import Toast from '../components/Toast';
import Dialog from '../components/Dialog';
import Button from '../components/Button';

// âœ… é¡µé¢ç»„ä»¶å¯ä»¥åˆ†åŒ…
const SettingsScreen = React.lazy(
  () => import(/* webpackChunkName: "settings" */ '../screens/SettingsScreen'),
);
```

### 4. Suspense åŒ…è£¹

**æ‰€æœ‰ä½¿ç”¨åˆ†åŒ…çš„å¯¼èˆªå™¨éƒ½å¿…é¡»ç”¨ `<Suspense>` åŒ…è£¹ï¼š**

```typescript
import React, { Suspense } from 'react';
import { ActivityIndicator, View } from 'react-native';

function LoadingFallback() {
  return (
    <View style={{ flex: 1, justifyContent: 'center', alignItems: 'center' }}>
      <ActivityIndicator size="large" color="#6366f1" />
    </View>
  );
}

function App() {
  return (
    <Suspense fallback={<LoadingFallback />}>
      <NavigationContainer>
        <RootNavigator />
      </NavigationContainer>
    </Suspense>
  );
}
```

---

## å¸¸è§é—®é¢˜

### Q1: å¦‚ä½•éªŒè¯æŸä¸ªé¡µé¢æ˜¯ä¸»åŒ…è¿˜æ˜¯åˆ†åŒ…ï¼Ÿ

**æ–¹æ³• 1ï¼šæŸ¥çœ‹å¯¼å…¥æ–¹å¼**

```typescript
// ä¸»åŒ…ï¼šç›´æ¥ import
import ProfileScreen from '../screens/ProfileScreen';

// åˆ†åŒ…ï¼šReact.lazy + webpackChunkName
const SettingsScreen = React.lazy(
  () => import(/* webpackChunkName: "settings" */ '../screens/SettingsScreen'),
);
```

**æ–¹æ³• 2ï¼šæŸ¥çœ‹æ‰“åŒ…è¾“å‡º**

```bash
# æ„å»º Android åæŸ¥çœ‹åˆ†åŒ…æ–‡ä»¶
ls -la android/app/build/generated/assets/react/release/

# è¾“å‡ºç¤ºä¾‹ï¼š
# index.android.bundle          # ä¸»åŒ…
# settings.android.bundle       # åˆ†åŒ…
# user-profile.android.bundle   # åˆ†åŒ…
```

### Q2: åº•éƒ¨ Tab çš„é¡µé¢åº”è¯¥ä¸»åŒ…è¿˜æ˜¯åˆ†åŒ…ï¼Ÿ

**ç­”æ¡ˆï¼šå…¨éƒ¨ä¸»åŒ…**

åŸå› ï¼š

1. ç”¨æˆ·å¯åŠ¨åå¯èƒ½ç«‹å³åˆ‡æ¢åˆ°ä»»ä½•ä¸€ä¸ª Tab
2. Tab åˆ‡æ¢éœ€è¦å³æ—¶å“åº”ï¼Œä¸èƒ½æœ‰åŠ è½½å»¶è¿Ÿ
3. åº•éƒ¨å¯¼èˆªæ˜¯æ ¸å¿ƒåŠŸèƒ½ï¼Œä¸åº”è¯¥åˆ†åŒ…

```typescript
// âœ… æ­£ç¡®ï¼šæ‰€æœ‰ Tab éƒ½æ˜¯ä¸»åŒ…
import HomeScreen from '../screens/HomeScreen';
import ExploreScreen from '../screens/ExploreScreen';
import OrdersScreen from '../screens/OrdersScreen';
import ProfileScreen from '../screens/ProfileScreen';
```

### Q3: å¦‚ä½•å¤„ç†åˆ†åŒ…ä¹‹é—´çš„å…±äº«çŠ¶æ€ï¼Ÿ

**ä½¿ç”¨ Zustand æˆ– React Context**

```typescript
// âœ… æ­£ç¡®ï¼šStore æ”¾åœ¨ä¸»åŒ…
// src/store/useAppStore.ts
import create from 'zustand';

export const useAppStore = create(set => ({
  user: null,
  setUser: user => set({ user }),
}));

// åˆ†åŒ…é¡µé¢å¯ä»¥ç›´æ¥ä½¿ç”¨
// src/screens/ProfileScreen.tsx (ä¸»åŒ…æˆ–åˆ†åŒ…éƒ½å¯ä»¥)
import { useAppStore } from '../store/useAppStore';

function ProfileScreen() {
  const { user } = useAppStore(); // âœ… çŠ¶æ€å…±äº«æ²¡é—®é¢˜
}
```

### Q4: åˆ†åŒ…é¡µé¢èƒ½å¯¼èˆªåˆ°ä¸»åŒ…é¡µé¢å—ï¼Ÿ

**å¯ä»¥ï¼Œå®Œå…¨æ”¯æŒ**

```typescript
// ä¸»åŒ…é¡µé¢
import LoginScreen from '../screens/LoginScreen';

// åˆ†åŒ…é¡µé¢
const SettingsScreen = React.lazy(
  () => import(/* webpackChunkName: "settings" */ '../screens/SettingsScreen'),
);

// âœ… åˆ†åŒ…é¡µé¢å¯ä»¥å¯¼èˆªåˆ°ä¸»åŒ…é¡µé¢
// SettingsScreen å†…éƒ¨
navigation.navigate('Login'); // å®Œå…¨æ²¡é—®é¢˜
```

### Q5: å¦‚ä½•é¿å…åˆ†åŒ…åŠ è½½æ—¶çš„ç™½å±ï¼Ÿ

**ä½¿ç”¨ Suspense + åŠ è½½æŒ‡ç¤ºå™¨**

```typescript
function App() {
  return (
    <Suspense
      fallback={
        <View
          style={{
            flex: 1,
            justifyContent: 'center',
            alignItems: 'center',
            backgroundColor: '#f8fafc',
          }}
        >
          <ActivityIndicator size="large" color="#6366f1" />
          <Text style={{ marginTop: 16, color: '#64748b' }}>åŠ è½½ä¸­...</Text>
        </View>
      }
    >
      <NavigationContainer>
        <RootNavigator />
      </NavigationContainer>
    </Suspense>
  );
}
```

---

## å¿«é€Ÿå†³ç­–æ ‘

```
è¿™ä¸ªé¡µé¢åº”è¯¥ä¸»åŒ…è¿˜æ˜¯åˆ†åŒ…ï¼Ÿ
â”‚
â”œâ”€ æ˜¯å¦æ˜¯åº•éƒ¨ Tab é¡µé¢ï¼Ÿ
â”‚  â””â”€ âœ… æ˜¯ â†’ ä¸»åŒ…
â”‚
â”œâ”€ æ˜¯å¦æ˜¯å¯åŠ¨/ç™»å½•/æ³¨å†Œé¡µï¼Ÿ
â”‚  â””â”€ âœ… æ˜¯ â†’ ä¸»åŒ…
â”‚
â”œâ”€ æ˜¯å¦æ˜¯é¦–é¡µ/å‘ç°é¡µç­‰é«˜é¢‘é¡µé¢ï¼Ÿ
â”‚  â””â”€ âœ… æ˜¯ â†’ ä¸»åŒ…
â”‚
â”œâ”€ æ˜¯å¦æ˜¯è®¾ç½®/å…³äºç­‰ä½é¢‘é¡µé¢ï¼Ÿ
â”‚  â””â”€ âœ… æ˜¯ â†’ åˆ†åŒ…
â”‚
â”œâ”€ æ˜¯å¦æ˜¯è¯¦æƒ…é¡µï¼ˆé€šçŸ¥è¯¦æƒ…ã€å•†å“è¯¦æƒ…ï¼‰ï¼Ÿ
â”‚  â””â”€ âœ… æ˜¯ â†’ åˆ†åŒ…
â”‚
â””â”€ ä¸ç¡®å®šï¼Ÿ
   â””â”€ ğŸ¤” é»˜è®¤ä¸»åŒ…ï¼ˆæ€§èƒ½ä¼˜å…ˆï¼‰ï¼ŒåæœŸä¼˜åŒ–æ—¶å†åˆ†åŒ…
```

---

## é¡¹ç›®å®é™…åº”ç”¨ç¤ºä¾‹

### å½“å‰é¡¹ç›®çš„ä¸»åŒ…é…ç½®

```typescript
// src/navigation/TabNavigator.tsx
import RecommendScreen from '../screens/RecommendScreen'; // âœ… ä¸»åŒ…
import ExploreScreen from '../screens/ExploreScreen'; // âœ… ä¸»åŒ…
import NotificationsScreen from '../screens/NotificationsScreen'; // âœ… ä¸»åŒ…
import ProfileScreen from '../screens/ProfileScreen'; // âœ… ä¸»åŒ…

// æ‰€æœ‰ Tab é¡µé¢éƒ½æ˜¯ä¸»åŒ…ï¼Œç¡®ä¿å¿«é€Ÿåˆ‡æ¢
```

### å¦‚æœéœ€è¦æ·»åŠ åˆ†åŒ…é¡µé¢

```typescript
// src/navigation/RootNavigator.tsx
import React, { Suspense } from 'react';
import { createNativeStackNavigator } from '@react-navigation/native-stack';

// ä¸»åŒ…
import TabNavigator from './TabNavigator';

// åˆ†åŒ…ï¼ˆæŒ‰éœ€æ·»åŠ ï¼‰
const SettingsScreen = React.lazy(
  () => import(/* webpackChunkName: "settings" */ '../screens/SettingsScreen'),
);

const AboutScreen = React.lazy(
  () => import(/* webpackChunkName: "about" */ '../screens/AboutScreen'),
);

const PrivacyPolicyScreen = React.lazy(
  () =>
    import(/* webpackChunkName: "privacy" */ '../screens/PrivacyPolicyScreen'),
);

export default function RootNavigator() {
  return (
    <Suspense fallback={<LoadingView />}>
      <Stack.Navigator>
        <Stack.Screen name="MainTabs" component={TabNavigator} />
        <Stack.Screen name="Settings" component={SettingsScreen} />
        <Stack.Screen name="About" component={AboutScreen} />
        <Stack.Screen name="Privacy" component={PrivacyPolicyScreen} />
      </Stack.Navigator>
    </Suspense>
  );
}
```

---

## æ€»ç»“

| é¡µé¢ç±»å‹    | æ¨èé…ç½® | åŸå›                  |
| ----------- | -------- | -------------------- |
| åº•éƒ¨ Tab é¡µ | ä¸»åŒ…     | å³æ—¶åˆ‡æ¢ï¼Œæ— åŠ è½½å»¶è¿Ÿ |
| å¯åŠ¨/ç™»å½•é¡µ | ä¸»åŒ…     | å¿…é¡»å¿«é€Ÿæ˜¾ç¤º         |
| é¦–é¡µ/å‘ç°é¡µ | ä¸»åŒ…     | é«˜é¢‘ä½¿ç”¨             |
| è®¾ç½®é¡µ      | åˆ†åŒ…     | ä½é¢‘ä½¿ç”¨             |
| å…³äº/å¸®åŠ©é¡µ | åˆ†åŒ…     | ä½é¢‘ä½¿ç”¨             |
| è¯¦æƒ…é¡µ      | åˆ†åŒ…     | æŒ‰éœ€åŠ è½½             |
| è¡¨å•é¡µ      | åˆ†åŒ…     | æŒ‰éœ€åŠ è½½             |

**è®°ä½ï¼š**

- âœ… ä¸»åŒ… = ç›´æ¥ `import`
- âœ… åˆ†åŒ… = `React.lazy()` + `/* webpackChunkName: "xxx" */`
- âœ… åˆ†åŒ…å¿…é¡»ç”¨ `<Suspense>` åŒ…è£¹
- âœ… åº•éƒ¨ Tab å…¨éƒ¨ä¸»åŒ…

---

å¦‚æœ‰ç–‘é—®ï¼Œè¯·å‚è€ƒé¡¹ç›®ä¸­çš„å®é™…ç¤ºä¾‹æˆ–æŸ¥é˜… Re.Pack å®˜æ–¹æ–‡æ¡£ï¼šhttps://callstack.github.io/repack/
